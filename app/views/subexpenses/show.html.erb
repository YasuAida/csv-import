<h1>付随費用</h1>

<div class="container-fluid">
  <div class="row">
    <table class="table">
      <thead>
        <tr>
          <th class="small">削除</th>
          <th class="small">ID</th>
          <th class="subexpense">諸掛項目</th>
          <th class="subexpense">按分方法</th>
          <th class="alloc_stock">按分先在庫</th>
          <th>日付</th>
          <th>通貨名</th>      
          <th>外貨建金額</th>
          <th>為替レート</th>
          <th>円金額</th>
          <th>支払先</th>
        </tr>
      </thead>
      <tbody>
        <% Subexpense.includes(:expense_relation_stocks).all.each do |subexpense| %>
          <tr>
            <%= form_for(subexpense, url: subexpense_path(subexpense)) do |f| %>
            <td class="btn btn-default navbar-btn small"><%= link_to "削除" , subexpense , method: :delete, data: { confirm: '削除してもよろしいですか？' } %></td>
            <th class="small"><%= subexpense.id %></th>
            <td class="subexpense"><%= f.collection_select(:item, ExpenseTitle.all, :item, :item, {include_blank: subexpense.item, include_hidden: true}) %></td>
            <td class="subexpense"><%= f.collection_select(:method, ExpenseMethod.all, :method, :method, {include_blank: subexpense.method, include_hidden: true} ,{multiple: true}) %></td>
            <td style="display:block; white-space:nowrap; overflow:scroll; height:100px; width:500px;">
              <% subexpense.expense_relation_stocks.each do |stock| %>
                <%= stock.date %> <%= stock.asin %> <%= stock.goods_name %><br>
              <% end %>
            </td>
            <td><%= f.text_field :date %></td>
            <td><%= f.text_field :currency %></td>
            <td><%= f.text_field :amount %></td>
            <td><%= subexpense.rate %></td>
            <% yen_amount = BigDecimal(subexpense.amount.to_s).round(2) * subexpense.rate %>
            <td><%= sprintf("%.0f",yen_amount) %></td>        
            <td><%= f.text_field :purchase_from %></td>
            <td><%= f.text_field :money_paid %></td>
            <td class="hidden-lg hidden-md hidden-sm hidden-xs"><%= f.submit %></td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

<%= link_to "新規登録画面へ", :action => "index" %>