<% content_for :head do %> 
  <div class="panel_container">
    <div class="panel panel-default">
    	<div class="panel-heading">
    	  マルチチャンネルＳＫＵ登録
    	</div>
      <div class="panel-body">
        <%= search_form_for(@q, url: multi_channels_path) do |f| %>
          <%= f.label :order_num_cont, "注文番号で検索" %>
          <%= f.search_field :order_num_cont %>
          <%= f.submit "検索", class: 'btn btn-default'%>
        <% end %>
        <%= search_form_for(@q, url: multi_channels_path) do |f| %>
          <%= f.label :sku_eq, "ＳＫＵで検索" %>
          <%= f.search_field :sku_eq %>
          <%= f.submit "検索", class: 'btn btn-default'%>
        <% end %>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table table-striped table-bordered table-condensed">
        <thead>
          <tr>
            <th class="update"><a href= ./multi_channels/destroy class="btn btn-default btn-sm">削除</th>
            <th class="middle">取引ID</th>
            <th class="account">日付</th>            
            <th class="reference">注文番号</th>
            <th class="order_num">ＳＫＵ</th>
            <th class="content">商品名</th>
            <th class="rate">個数</th>
            <th class="update">更新</th>           
          </tr>
        </thead>
  <% end %>
        <tbody class="expenseledgers">
          <% @multi_channels.each do |multi_channel| %>
            <tr>
              <%= form_for(multi_channel, url: multi_channel_path(multi_channel), remote: true) do |f|  %>
                <td class="update" id="check-<%= multi_channel.id %>"><%= f.check_box :destroy_check, {}, "true", "false" %></td>
                <td class="middle"><%= multi_channel.sale_id %></td>
                <td class="account"><%= f.text_field :date, :size => "8"%></td> 
                <td class="reference"><%= f.text_field :order_num, :size => "18", readonly: true %></td>              
                <td class="order_num"><%= f.text_field :sku, :size => "16"%></td>
                
              <% sku_stock = current_user.stocks.find_by(sku: multi_channel.sku) %>
              <% sku_stockaccept = current_user.stockaccepts.find_by(sku: multi_channel.sku) %>
              
              <% if sku_stockaccept.present? %>
                <% multi_goods_name = sku_stockaccept.goods_name %>
              <% elsif sku_stock.present? %>
                <% multi_goods_name = sku_stock.goods_name %>
              <% end %>
                <td class="content"><%= multi_goods_name %>
                <td class="rate"><%= f.text_field :number, :size => "2", :style=>"text-align:right"%></td>                
                <td class="update" id="submit-<%= multi_channel.id %>"><%= f.submit "更新", class: 'btn btn-default btn-sm'%></td>
                
                <!--チェックボックス更新用JQuery-->
                <script>
                  $("#check-<%= multi_channel.id %>").change(function(e){
                    $('#edit_multi_channel_<%= multi_channel.id %>').submit();
                  });
                </script> 
              <% end %>
            <% end %>
          </tr>
        </tbody>
  <% content_for :foot do %>
        <%= form_for(@multi_channel) do |f| %>
          <tbody class="footer">    
            <tr>
              <td class="update"></td>
              <td class="middle"><%= f.text_field :sale_id, :size => "4" %></td>
              <td class="account"><%= f.text_field :date, :size => "8"%></td>               
              <td class="reference"><%= f.text_field :order_num, :size => "18" %></td>           
              <td class="order_num"><%= f.text_field :sku, :size => "16"%></td>          
              <td class="content"></td>
              <td class="rate"><%= f.text_field :number, :size => "2", :style=>"text-align:right"%></td>                
              <td class="update"><%= f.submit "登録", class: 'btn btn-default btn-sm' %></td>
            </tr>
          </tbody>
        <% end %>
      </table>
    <%= paginate @multi_channels %>
    <p>
      Download:
      <%= link_to "CSV形式でダウンロード", multi_channels_path(format: "csv") %>
    </p>
<% end %>
  </div>
</div>

