<h1>廃棄商品</h1>

<%= search_form_for(@q, url: disposals_path) do |f| %>
  <%= f.label :sku_eq, "ＳＫＵで検索" %>
  <%= f.search_field :sku_eq %>
  <%= f.submit "検索" %>
<% end %>

<div style="table-layout: fixed;">
  <table class="table table-striped">
    <thead>
      <tr>
        <th class="small">削除</th>
        <th class="middle">仕入ID</th>
        <th class="account">日付</th>        
        <th class="order_num">注文番号</th>
        <th class="order_num">ＳＫＵ</th>
        <th class="content">商品名</th>      
        <th class="rate">個数</th>      
      </tr>
    </thead>
    <tbody>
      <% @disposals.each do |good| %>
        <tr>
          <td class="small"><%= link_to "削除" , good , method: :delete, data: { confirm: '削除してもよろしいですか？' } %></td>
          <%= form_for(good, url: disposal_path(good.id)) do |f| %>
            <td class="middle"><%= f.text_field :stock_id, readonly: true, :size=> "4", :style=>"text-align:right"%></td>
            <td class="account"><%= f.text_field :date, :size => "8"%></td>     
            <td class="order_num"><%= f.text_field :order_num, readonly: true, :size => "18"%></td>
            <td class="order_num"><%= f.text_field :sku, :size => "18"%></td>
            
          <% stock_name = Stock.find_by(sku: good.sku) %>
          <% return_good = ReturnGood.find_by(new_sku: good.sku) %>
          <% if stock_name.present? %>
            <td class="content"><%= stock_name.goods_name %></td>
          <% elsif return_good.present?%>
          <% stock_name = Stock.find_by(sku: return_good.old_sku) %>          
            <td class="content"><%= stock_name.goods_name %></td>
          <% end %>
          
            <td class="rate"><%= f.text_field :number, :size => "2", :style=>"text-align:right"%></td>          
            <td class= "hidden-lg hidden-md hidden-sm hidden-xs"><%= f.submit %></td>
          <% end %> 
        </tr>
      <% end %>
      <%= form_for(@disposal) do |f| %>
        <tr>
            <td class="small"></td>
            <td class="middle"></td>
            <td class="account"><%= f.text_field :date, :size => "8"%></td> 
            <td class="order_num"><%= f.text_field :order_num, :size => "18"%></td>            
            <td class="order_num"><%= f.text_field :sku, :size => "18"%></td>
            <td class="content"></td>
            <td class="rate"><%= f.text_field :number, :size => "2", :style=>"text-align:right"%></td>           
            <td class="hidden-lg hidden-md hidden-sm hidden-xs"><%= f.submit %></td>
        </tr>
      <% end %>
    </tbody>
    <%= paginate @disposals %>
  </table>
</div>

<p>
  Download:
  <%= link_to "CSV形式でダウンロード", disposals_path(format: "csv") %>
</p>
