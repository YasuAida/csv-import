<h1>仕入台帳（ＳＫＵ無し）</h1>

<div class="container-fluid">
  <div class="row">
    <table>
      <thead>
        <tr>
          <th class="col-sm-1">ID</th>
          <th class="col-sm-1">日付</th>
          <th class="col-sm-1"></th>
          <th class="col-sm-1">ASIN</th>
          <th class="col-sm-1">商品名</th>
          <th class="col-sm-1">個数</th>
          <th class="col-sm-1">単価</th>
          <th class="col-sm-1">小計(外貨)</th>
          <th class="col-sm-1">為替レート</th>
          <th class="col-sm-1">小計(円貨)</th>
          <th class="col-sm-1">支払日</th>
          <th class="col-sm-1">購入先</th>
          <th class="col-sm-1">通貨</th>
        </tr>
      </thead>
      <tbody>
        <% @no_sku_stocks = Stock.where(sku: "") %>
        <% @no_sku_stocks.each do |stock| %>
          <tr>
            <td><%= stock.id %></td>
                <%= form_for(stock, url: stock_path(stock.id)) do |f|  %>
            <td><%= f.text_field :purchase_date %></td>
            <td><%= f.text_field :sku %></td>
            <td><%= f.text_field :asin %></td>
            <td><%= f.text_field :goods_name %></td>
            <td><%= f.number_field :number %></td>            

                <% ex_currency = Currency.find_by(name: stock.currency) %>
                <% if ex_currency.method == "外貨×為替レート"%>
            <td><%= f.text_field :unit_price %></td>                 
                <% sub_total = stock.number.to_i * BigDecimal(stock.unit_price.to_s).round(2) %>
            <td><%= sprintf("%.2f",sub_total) %></td>
                <% else %>
            <td><%= f.text_field :unit_price %></td>                 
                <% sub_total = stock.number.to_i * BigDecimal(stock.unit_price.to_s).round(0) %>
            <td><%= sprintf("%.0f",sub_total) %></td>
                <% end %>
                
            <td><%= stock.rate %></td>
            <td><%= sprintf("%.0f",stock.goods_amount) %></td>
            <td><%= f.text_field :money_paid %></td> 
            <td><%= f.text_field :purchase_from %></td>             
            <td><%= f.text_field :currency%></td>
            <td class="hidden-lg hidden-md"><%= f.submit %></td>
                <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>